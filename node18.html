<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.70)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>การเก็บตัวแปรการคำนวณในคอมพิวเตอร์ฮาร์ดแวร์</TITLE>
<META NAME="description" CONTENT="การเก็บตัวแปรการคำนวณในคอมพิวเตอร์ฮาร์ดแวร์">
<META NAME="keywords" CONTENT="comor">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="comor.css">

<LINK REL="next" HREF="node19.html">
<LINK REL="previous" HREF="node17.html">
<LINK REL="up" HREF="node14.html">
<LINK REL="next" HREF="node19.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html753"
  HREF="node19.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="icons/next.png"></A> 
<A NAME="tex2html747"
  HREF="node14.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="icons/up.png"></A> 
<A NAME="tex2html741"
  HREF="node17.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="icons/prev.png"></A> 
<A NAME="tex2html749"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="icons/contents.png"></A> 
<A NAME="tex2html751"
  HREF="node199.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index"
 SRC="icons/index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html754"
  HREF="node19.html">การแสดงคำสั่งในคอมพิวเตอร์</A>
<B> Up:</B> <A NAME="tex2html748"
  HREF="node14.html">คำสั่ง: ภาษาของคอมพิวเตอร์</A>
<B> Previous:</B> <A NAME="tex2html742"
  HREF="node17.html">การทำงานของคอมพิวเตอร์ฮาร์ดแวร์</A>
 &nbsp; <B>  <A NAME="tex2html750"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html752"
  HREF="node199.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00440000000000000000">
การเก็บตัวแปรการคำนวณในคอมพิวเตอร์ฮาร์ดแวร์</A>
</H1>
<P>
<I>คอมพิวเตอร์ฮาร์ดแวร์ จะทำการคำนวณบนหน่วยความจำเล็กๆ ที่มีความเร็วสูงที่เรียกว่า <EM>รีจีสเตอร์</EM> <A NAME="10839"></A><A NAME="5966"></A> ผู้เขียนโปรแกรมสามารถใช้รีจีสเตอร์เหล่านี้ทำการคำนวณในขั้นตอนต่างๆ ซึ่งจะแตกต่างกับการเขียนโปรแกรมในภาษาระดับสูงที่สามารถนิยามตัวแปรได้หลากหลาย ที่รีจีสเตอร์ในฮาร์ดแวร์มีจำนวนจำกัด ในสถาปัตยกรรม MIPS มีจำนวนรีจีสเตอร์จำนวน 32 ตัว โดยแต่ละตัวขนาดมี 32 บิต ขนาดของ 32 บิตใน MIPS เรียกว่าหนึ่ง Word อย่างไรก็ตามการใช้งานรีจิสเตอร์เหล่านี้จะมีการแบ่งกลุ่มให้สามารถใช้งานได้ในลักษณะงานที่แตกต่างกัน
</I>
<P>
<I>เหตุที่ในคอมพิวเตอร์ฮาร์ดแวร์มีจำนวนรีจีสเตอร์จำกัด นำมาสู่หลักการออกแบบที่สองได้แก่
</I>
<P>
<BLOCKQUOTE><I>Design Principle 2: Smaller is faster.
</I></BLOCKQUOTE>
<P>
<I>ในวงจรไฟฟ้าที่เป็นพื้นฐานของระบบ คอมพิวเตอร์ที่ทำงานโดยอาศัยการเคลื่อนที่ของอีเล็กตรอน ยิ่งระยะทางในการเคลื่อนที่มีน้อยเท่าไร ก็สามารถออกแบบวงจรให้ทำงานได้ความเร็วมากขึ้น วงจรที่มีขนาดเล็กก็สามารถสื่อถึงความซับซ้อนของวงจรด้วย ยิ่งระบบมีขนาดเล็ก และมีความซับซ้อนน้อยลงเท่าใด จะสามารถทำให้ทำงานได้เร็วขึ้น ในรูปของความเร็วสัญญาณนาฬิกา ในการระบุถึงตัวรีจีสเตอร์ต่างๆ จะใช้ตัวอักษรสองตัว เริ่มด้วยเครื่องหมาย $ เช่น <TT>$s0, $s1, $s2, <IMG
 WIDTH="27" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img29.png"
 ALT="$\ldots$"></TT> สำหรับ รีจิสเตอร์ที่เป็นตัวแปรในภาษา C และ ภาษา JAVA และ 
<TT>$t0, $t1,</TT> <IMG
 WIDTH="27" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img29.png"
 ALT="$\ldots$"> สำหรับเป็นตัวแปรชั่วคราวในการคำนวณตามโปรแกรมที่ตัวแปลงภาษาจะใช้งานรีจีสเตอร์เหล่านี้ 
</I>
<P>
<I>การแปลงชุดของภาษา C โดยใช้รีจีสเตอร์
</I>
<P>
<I>หน้าที่ของตัวแปลงภาษาคือทำการแปลงตัวแปร ในภาษาระดับสูง เป็นการใช้งานในรีจีสเตอร์เพื่อทำการคำนวณ จากตัวอย่างที่แล้ว
</I>
<P><PRE>
f = (g + h) - (i + j);
</PRE>
<P>
<I>ตัวแปรเป็น f, g, h, i, และ j  ถูกกำหนดให้กับรีจีสเตอร์ <TT>$s0, $s1, $s2, $s3,</TT> 
และ <TT>$s4</TT>, ตามลำดับ  จงเขียนโค๊ดของ MIPS
</I>
<P>
<I>การแปลงภาษามีวิธีการคล้ายที่แล้วมา เพียงแต่ใช้งาน <TT>$t0</TT> และ <TT>$t1</TT> ในการเก็บตัวแปร
</I>
<P><PRE>
add $t0, $s1, $s2 # temporary variable t0 contains g + h
add $t1, $s3, $s4 # temporary variable t1 contains i + j
sub $s0, $t0, $t1 # f gets t0 - t1, which is (g + h)-(i + j)
</PRE>
<P>
<I>
<B><FONT SIZE="+1">ตัวแปรที่อยู่ในหน่วยความจำ</FONT></B>
</I>
<P>
<I>ในการเขียนโปรแกรม จะรองรับโครงสร้างข้อมูลที่มีลักษณะที่แตกต่างกันออกไป จากข้อมูลพื้นฐาน มาเป็นข้อมูลที่มีความสลับซับซ้อน เช่น ข้อมูลที่เป็นตาราง หรือ เป็นโครงสร้างในลักษณะต่างๆ   ลักษณะข้อมูลดังกล่าวอาจมีขนาดมากกว่า ขนาดของรีจีสเตอร์ ทั้งสองตัวที่มีอยู่ หรือขนาดของข้อมูลในการคำนวณของโปรแกรมนั้นๆ อาจมีขนาดใหญ่มาก ซึ่งโปรเซสเซอร์จะเก็บข้อมูลไว้จำนวนไม่มากไว้ในรีจีสเตอร์ และ ข้อมูลส่วนใหญ่หรือทั้งหมดไว้ในหน่วยความจำหลัก  
</I>
<P>
<I>การคำนวณทางคณิตศาสตร์ในชุดคำสั่งของ MIPS ตัวแปรที่ทำการคำนวณจะต้องอยู่ในรีจีสเตอร์ เท่านั้น เพราะฉะนั้นชุดคำสั่ง MIPS จะต้องรวมคำสั่งของการถ่ายโอนข้อมูลระหว่างรีจีสเตอร์และหน่วยความจำ  เราเรียกคำสั่งเหล่านี้ว่า คำสั่งถ่ายโอนข้อมูล (Data Transfer Instructions) ในการที่จะเข้าใช้งานไม่ว่าจะอ่านหรือเขียนในหน่วยความจำ คำสั่งถ่ายโอนข้อมูลจะต้องมีแอดเดรสหรือข้อมูลตำแหน่งของหน่วยความจำที่ต้องการใช้งาน เราสามารถพิจารณาให้หน่วยความจำมีลักษณะเป็นอาเรย์มิติเดียวขนาดใหญ่  ที่มีแอดเดรสเป็นตัวระบุตำแหน่งอ้างอิงของอาเรย์  ตัวอย่างเช่นในรูป <A HREF="#fig:mem">2.1</A> แอดเดรสของข้อมูลตัวที่สาม มีค่าเท่ากับสอง และค่าในแอดเดรสดังกล่าว Memory[2] มีค่าเท่ากับ 10 
<A NAME="6418"></A><A NAME="6419"></A>
</I>
<P>
<DIV ALIGN="CENTER"><A NAME="fig:mem"></A><A NAME="10841"></A>
<TABLE>
<CAPTION ALIGN="BOTTOM"><STRONG>Figure 2.1:</STRONG>
แอดเดรสในหน่วยความจำ และ ข้อมูลที่บรรจุในหน่วยความจำ</CAPTION>
<TR><TD>
<DIV ALIGN="CENTER"><IMG
 WIDTH="345" HEIGHT="273" ALIGN="BOTTOM" BORDER="0"
 SRC="img37.png"
 ALT="\includegraphics[width=3in]{fig/Chapter_2/Figure_2.2.eps}">
</DIV></TD></TR>
</TABLE>
</DIV>
<P>
<I>คำสั่งถ่ายโอนข้อมูลที่ทำหน้าที่คัดลอกข้อมูลที่ต้องการจากหน่วยความจำเข้ามาสู่รีจีสเตอร์ เรียกว่า การโหลด (load) โดยที่รูปแบบของคำสั่งเป็น รีจีสเตอร์ที่จะเป็นที่เก็บข้อมูล และ ตามด้วยเลขจำนวนเต็มที่เป็นค่าคงที่ และรีจีสเตอร์ที่เก็บแอดเดรส หรือตำแหน่งที่ใช้เทียบเคียงในการโหลด ผลบวกของค่าคงที่และค่าแอดเดรสที่อยู่ในรีจีสเตอร์ตัวหลังเป็นค่าของแอดเดรสของข้อมูลที่ทำการโหลด  ชื่อของคำสั่ง MIPS คือ ``lw'' ย่อมาจาก <EM>load word</EM>
<A NAME="6510"></A>
</I>
<P>
<I>
<B>การแปลงภาษาเมื่อตัวแปรอยู่ในหน่วยความจำ</B>
</I>
<P>
<I>กำหนดให้อาเรย์ A ประกอบด้วย 100 Words และ ตัวแปลภาษาหรือคอมไพเลอร์ จะทำการกำหนดคู่ระหว่างตัวแปร <TT>g</TT> และ <TT>h</TT> กับรีจีสเตอร์ <TT>$s1</TT> และ <TT>$s2</TT> และสมมุติให้ base address อยู่ที่  <TT>$s3</TT> 
</I>
<P><PRE>
g = h + A[8];
</PRE>
<P>
<I>ในขั้นแรก จะทำการโหลดข้อมูลจากตำแหน่ง 8 ไบต์ห่างจากแอดเดรสที่ระบุไว้ใน <TT>$s3</TT> จากนั้นนำค่าของข้อมูลมาเก็บไว้ในรีจีสเตอร์ชั่วคราว   <TT>$t0</TT> เพื่อทำการบวกกับตัวแปร   <TT>h</TT> ต่อไป
</I>
<P><PRE>
lw $t0, 8 ($s3) # Temporary reg $t0 gets A[8]
add $s1, $s2, $t0 # g = h + A[8]
</PRE>
<P>
<I>ค่า 8 เรียกว่าค่า offset ส่วนค่าใน  <TT>$s3</TT> เรียกว่าค่า Base โดยที่  <TT>s3</TT> เรียกว่า Base Register
</I>
<P>
<I>หน้าที่ของตัวแปลงภาษานอกจากจะต้องทำการกำหนดการใช้งานระหว่างตัวแปรในภาษาระดับสูงแล้ว กับรีจีสเตอร์ต่างๆ แล้ว ยังจะต้องกำหนดค่าเริ่มต้นของแอดเดรสที่ถูกต้อง ให้กับหน่วยความจำ เพื่อให้ได้มาซึ่งการถ่ายโอนข้อมูลที่ถูกต้อง ในทางคอมพิวเตอร์ เราถือว่าข้อมูลขนาด 1 บิตเป็นข้อมูลที่เล็กที่สุด และ 8 บิตมีขนาดเท่ากับ 1 ไบต์ ใน MIPS 4 ไบต์เท่ากับ 1 Wordจากรูป <A HREF="#fig:wordalign"
 NAME="6651">2.2</A> แสดงถึงการวางข้อมูลที่เป็น Word ลงในหน่วยความจำ โดยที่ Word แรก อยู่ที่แอดเดรส 0 และ Word ต่อมาอยู่ห่างออกมา 4 ไบต์ ที่แอดเดรส 4 และเรียงกันต่อมาทีละ 4 ไบต์  ใน MIPS กำหนดไว้ว่าการวางข้อมูลในหน่วยความจำจะต้องทำครั้งละ 4 ไบต์ ส่วนใหญ่แล้วโปรเซสเซอร์ต่างๆ จะกำหนด Alignment Restriction  นั้นคือการเริ่มต้นของ Word จะต้องเริ่มที่ <!-- MATH
 $0, 4, 8, 12, \ldots$
 -->
<IMG
 WIDTH="107" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img38.png"
 ALT="$0, 4, 8, 12, \ldots$"> คอมพิวเตอร์จะทำการแบ่งการใช้งาน Word ออกเป็นสองแบบเรียกว่าค่าย Big Endian และค่าย Little Endian ในค่าย Big Endian แอดเดรสทางซ้ายสุดจะทำการชี้ที่ Word ส่วนในของ Little Endian แอดเดรสทางขวาสุดจะเป็นตัวชี้ที่ Word โปรเซสเซอร์ MIPS อยู่ในค่าย Big Endian
</I>
<P>
<DIV ALIGN="CENTER"><A NAME="fig:wordalign"></A><A NAME="10843"></A>
<TABLE>
<CAPTION ALIGN="BOTTOM"><STRONG>Figure 2.2:</STRONG>
การแบ่ง Word สำหรับแอดเดรสในหน่วยความจำ และ ข้อมูลที่บรรจุในหน่วยความจำ</CAPTION>
<TR><TD>
<DIV ALIGN="CENTER"><IMG
 WIDTH="345" HEIGHT="273" ALIGN="BOTTOM" BORDER="0"
 SRC="img39.png"
 ALT="\includegraphics[width=3in]{fig/Chapter_2/Figure_2.3.eps}">
</DIV></TD></TR>
</TABLE>
</DIV>
<P>
<I>คำสั่งที่ตรงข้ามกับ Load คือคำสั่ง Store ที่ทำการคัดลอกถ่ายโอนข้อมูลจากรีจีสเตอร์ ไปบังหน่วยความจำ การใช้งานคำสั่ง Store มีลักษณะคล้ายกับ Load โดยใช้สัญลักษณ์ sw ที่ย่อมาจาก Store Word
<A NAME="6781"></A>
</I>
<P>
<I>
<B><FONT SIZE="+1">การแปลงภาษาที่มีคำสั่ง Load และ Store</FONT></B>
</I>
<P>
<I>สมมุติให้ตัวแปร <TT>h</TT> อยู่ในรีจีสเตอร์ <TT>$s2</TT> และตำแหน่งเริ่มต้นของอาเรย์ A อยู่ที่รีจีสเตอร์ <TT>$s3</TT> จงทำการแปลงชุดของภาษา C ดังต่อไปนี้ ให้เป็นภาษาแอสแซมบลีของ MIPS ดังต่อไปนี้
</I>
<P><PRE>
A[12] = h + A[8];
</PRE>
<P>
<I>ถึงแม้ว่าภาษา C ข้างบนมีเพียงหนึ่งบรรทัด  มีตัวแปรถึงสองตัวอยู่ในหน่วยความจำ เราจึงจำเป็นต้องใช้งานคำสั่ง MIPS มากขึ้นเพื่อสามารถถ่ายโอนตัวแปรจากหน่วยความจำ มาที่รีจีสเตอร์ก่อนทำการประมวลผล ในขั้นแรกทำการเรียกค่าใน A[8] มาที่รีจีสเตอร์ <TT>$t0</TT>: และทำการบวกค่า <TT>$s2</TT> เก็บผลลัพธ์ในรีจีสเตอร์  <TT>$t0</TT>
</I>
<P><PRE>
lw $t0, 32($s3) # Temporary reg $t0 gets A[8]
add $t0, $s2, $t0 # Temporary reg $t0 gets h + A[8]
</PRE>
<P>
<I>จากนั้นทำการเก็บค่านั้น เข้าไปที่หน่วยความจำ A[12] โดยใช้ค่า 48 บวกกับตำแหน่งเริ่มต้นของอาเรย์ A อยู่ที่รีจีสเตอร์ <TT>$s3</TT> 
</I>
<P><PRE>
sw $t0, 48($s3) # Store h + A[8] back into A[12]
</PRE>
<P>
<I>
<B><FONT SIZE="+1">การประมวลผลสำหรับตัวแปรที่เป็นค่าคงที่</FONT></B>
</I>
<P>
<I>ในการพัฒนาโปรแกรมนั้น มีการประมวลผลจำนวนมากที่กระทำการกับค่าคงที่  เช่น การเพิ่มค่าดัชนี ในการคำนวณอาเรย์ หรือเมทริกซ์  
ในทางเป็นจริง จากการวิเคราะห์ SPEC2000 Benchmarks มากกว่าครึ่งของการประมวลผลทั้งหมดเป็นการคำนวณที่มีค่าคงที่เป็นส่วนหนึ่งของตัวแปร
</I>
<P>
<I>จากคำสั่งของ MIPS ที่ผ่านมา การใช้งานค่าคงที่จำเป็นต้องใช้สองคำสั่ง โดยคำสั่งแรกทำการเรียกค่าคงที่จากหน่วยความจำ 
 และจากนั้นทำการประมวลผลอีกครั้งหนึ่ง (ค่าคงที่นั้นๆ ต้องถูกเก็บไว้ในหน่วยความจำก่อนหน้า) ตัวอย่างเช่น การบวกค่าคงที่ 4 
 กับค่าในรีจีสเตอร์ <TT>$s3</TT> สามารถใช้คำสั่งดังต่อไปนี้
</I>
<P><PRE>  
lw $t0, AddrConstant4($s1) # $t0 = constant 4
add $s3, $s3, $t0 # $s3 = $s3 + $t0 ( $t0 == 4)
</PRE>
<P>
<I>โดยสมมุติให้ AddrConstant4 เป็นตำแหน่งเก็บหน่วยความจำของค่าคงที่ 4
</I>
<P>
<I>การทำการถ่ายโอนค่าคงที่จากหน่วยความจำนั้น เป็นการสิ้นเปลืองทรัพยากร เนื่องจากต้องทำการย้ายข้อมูลจากหน่วยตวามจำมายังรีจีสเตอร์หลายครั้ง ในคำสั่ง MIPS จึงมึคำสั่งที่สามารถบวกตัวแปรในรีจีสเตอร์กับค่าคงที่ได้ในคำสั่งเดียว เรียกว่าคำสั่ง ``add immediate'' หรือ <TT>addi</TT> ในการบวกค่าคงที่ 4 กับค่าในรีจีสเตอร์ <TT>$s3</TT> สามารถได้ในคำสั่งดังต่อไปนี้
<A NAME="7058"></A>
</I>
<P><PRE>
addi $s3, $s3, 4 # $s3 = $s3 + 4
</PRE>
<P>
<I>คำสั่งขั้นต้น เป็นคำสั่งที่นำมาสู่หลักการพื้นฐานในการออกแบบคอมพิวเตอร์ในข้อที่สาม ได้แก่
</I>
<P>
<BLOCKQUOTE><I>Design Principle 3: Make the common case fast
</I></BLOCKQUOTE>
<P>
<I>ในโปรแกรมจริงพบว่ามีคำสั่งเป็นจำนวนมากที่ดำเนินการประมวลผลระหว่างตัวแปรกับค่าคงที่  การที่มีคำสั่งบวกค่าคงที่กับค่าตัวแปรมนรีจีสเตอร์ในหนึ่งคำสั่งโดยไม่ต้องโหลดข้อมูลจากหน่วยความจำทำให้รวดเร็วกว่ามาก
</I>
<P><HR>
<!--Navigation Panel-->
<A NAME="tex2html753"
  HREF="node19.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="icons/next.png"></A> 
<A NAME="tex2html747"
  HREF="node14.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="icons/up.png"></A> 
<A NAME="tex2html741"
  HREF="node17.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="icons/prev.png"></A> 
<A NAME="tex2html749"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="icons/contents.png"></A> 
<A NAME="tex2html751"
  HREF="node199.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index"
 SRC="icons/index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html754"
  HREF="node19.html">การแสดงคำสั่งในคอมพิวเตอร์</A>
<B> Up:</B> <A NAME="tex2html748"
  HREF="node14.html">คำสั่ง: ภาษาของคอมพิวเตอร์</A>
<B> Previous:</B> <A NAME="tex2html742"
  HREF="node17.html">การทำงานของคอมพิวเตอร์ฮาร์ดแวร์</A>
 &nbsp; <B>  <A NAME="tex2html750"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html752"
  HREF="node199.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
Vara Varavithya
2005-08-18
</ADDRESS>
</BODY>
</HTML>
